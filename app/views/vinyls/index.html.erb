<%= render 'layouts/table' %>

<script type='text/javascript' charset='utf-8'>
$(function() {
    $.ajax({
        type: 'GET',
        url: '/vinyls.json'
    }).done(function(data) {
        console.log(data);
        let div_html = '';
        $.each(data, function( index, value ) {
            let newVinyl = new Vinyl(value);
            div_html += newVinyl.formatIndex();
            console.log(div_html);
        });
    
        $('#vinyls_table').html(div_html);
    });

    function Vinyl(vinyl) {
        this.id = vinyl.id;
        this.title = vinyl.title;
        this.price = vinyl.price;
        this.inventory = vinyl.inventory;
        this.for_sale = vinyl.for_sale;
        this.artist_id = vinyl.artist.id;
        this.artist_name = vinyl.artist.name;
    }

    Vinyl.prototype.formatIndex = function() {
        let base_url = 'http://localhost:3000';
        let vinyl_html = '<tr>';
        vinyl_html += `<th scope="row"><a href="${base_url}/artists/${this.artist_id}">${this['artist_name']}</a></th>`;
        vinyl_html += `<th scope="row"><a href="${base_url}/vinyls/${this['id']}">${this['title']}</a></th>`;
        vinyl_html += '<th scope="row">' + this['price'] +'</th>';
        vinyl_html += '<th scope="row">' + this['inventory'] +'</th>';
        vinyl_html += '<th scope="row">' + this['for_sale'] +'</th>';
        vinyl_html += '</tr>';
        return vinyl_html;
    }
});
</script>